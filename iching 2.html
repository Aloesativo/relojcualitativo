<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Reloj I Ching â€” Horror Pixel</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  html, body {
    margin:0; padding:0;
    background:#000;
    height:100%;
    overflow:hidden;
  }
  canvas {
    display:block;
    margin:0 auto;
    background:#000;
    image-rendering: pixelated;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
// ===== CONFIG =====
const FG = "#FFFFFF";  // blanco puro
const BG = "#000000";  // negro puro
let paused = false;
let invert = false;
let mode = "scale";
let order = "binary"; // "binary" o "consecutive"

// ===== UTILIDADES =====
function clamp(n,a,b){return Math.min(b,Math.max(a,n));}
function toInt(n,d=0){return Number.isFinite(+n)?Math.trunc(+n):d;}
function clamp1to64(n){return clamp(toInt(n,1),1,64);}
function mapToHexagram(value,maxExclusive,mode){
  value=clamp(toInt(value,0),0,Number.MAX_SAFE_INTEGER);
  maxExclusive=clamp(toInt(maxExclusive,0),0,Number.MAX_SAFE_INTEGER);
  if(mode==="mod"){
    const v=((value%64)+64)%64; return v+1;
  }
  if(maxExclusive<=1) return 1;
  const ratio=value/(maxExclusive-1);
  return clamp1to64(Math.floor(Math.min(1,Math.max(0,ratio))*63)+1);
}
function bitsFromIndexBinary(i){return clamp(toInt(i,0),0,63);}

// ===== HEXAGRAMA =====
function drawHexagramBits(ctx,bits,x,y,size){
  const b=bits & 63;
  const lineH = Math.max(2, Math.floor(size / 9));
  const gap = Math.max(1, Math.floor(lineH / 2));
  const pad = Math.floor((size - 6*lineH - 5*gap) / 2);
  ctx.fillStyle = invert ? BG : FG;
  for(let i=0;i<6;i++){
    const bit=(b>>i)&1;
    const yy=y+pad+(5-i)*(lineH+gap);
    if(bit===1){
      ctx.fillRect(x+2, yy, size-4, lineH);
    } else {
      ctx.fillRect(x+2, yy, Math.floor((size-4)/2)-2, lineH);
      ctx.fillRect(x+2+Math.ceil((size-4)/2)+2, yy, Math.floor((size-4)/2)-2, lineH);
    }
  }
}

// ===== CANVAS =====
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// ===== CONTROLES =====
document.addEventListener("keydown", e=>{
  if(e.code==="Space") paused=!paused;
  if(e.key==="i"||e.key==="I") invert=!invert;
  if(e.key==="m"||e.key==="M") mode=(mode==="scale"?"mod":"scale");
  if(e.key==="o"||e.key==="O") order=(order==="binary"?"consecutive":"binary");
});

// ===== DIBUJO =====
function draw(){
  // Fondo
  ctx.fillStyle = invert ? FG : BG;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  const now = new Date();
  const h = now.getHours();
  const m = now.getMinutes();
  const s = now.getSeconds();

  const color = invert ? BG : FG;
  ctx.fillStyle = color;
  ctx.strokeStyle = color;

  const margin = 30;
  const availableW = canvas.width - margin*2;
  const availableH = canvas.height - margin*2;

  // Marco
  ctx.lineWidth = 4;
  ctx.strokeRect(margin, margin, availableW, availableH);

  // Reloj
  ctx.font = `${Math.floor(canvas.height*0.05)}px 'Press Start 2P'`;
  ctx.textAlign = "center";
  ctx.fillText(now.toLocaleTimeString([], {hour12:false}), canvas.width/2, margin + 40);

  // Hexagramas
  const hexSize = Math.floor(Math.min(availableW/5, availableH/2.5));
  const yHex = canvas.height/2 - hexSize/2;

  const nH = mapToHexagram(h,24,mode);
  const nM = mapToHexagram(m,60,mode);
  const nS = mapToHexagram(s,60,mode);
  const bH = bitsFromIndexBinary(nH-1);
  const bM = bitsFromIndexBinary(nM-1);
  const bS = bitsFromIndexBinary(nS-1);

  drawHexagramBits(ctx,bH, canvas.width/2 - hexSize - hexSize*1.2, yHex, hexSize);
  drawHexagramBits(ctx,bM, canvas.width/2 - hexSize/2, yHex, hexSize);
  drawHexagramBits(ctx,bS, canvas.width/2 + hexSize*0.7, yHex, hexSize);

  // Etiquetas
  ctx.font = `${Math.floor(canvas.height*0.03)}px 'Press Start 2P'`;
  ctx.fillText("HORA", canvas.width/2 - hexSize - hexSize*1.2 + hexSize/2, yHex + hexSize + 25);
  ctx.fillText("MIN",   canvas.width/2 - hexSize/2 + hexSize/2,            yHex + hexSize + 25);
  ctx.fillText("SEG",   canvas.width/2 + hexSize*0.7 + hexSize/2,          yHex + hexSize + 25);

  // Info abajo
  ctx.font = `${Math.floor(canvas.height*0.025)}px 'Press Start 2P'`;
  ctx.textAlign="left";
  ctx.fillText("ORD:"+order.toUpperCase(), margin+5, canvas.height - margin + 15);
  ctx.textAlign="right";
  ctx.fillText("MOD:"+mode.toUpperCase(), canvas.width - margin - 5, canvas.height - margin + 15);
}

function loop(){
  if(!paused) draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
